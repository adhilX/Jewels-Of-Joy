<%- include('../partials/user/header') %>


    <style>
        .disabled-radio {
            accent-color: #d3d3d3;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .payment-box {
            display: flex;
            align-items: center;
        }

        .fa-info-circle {
            cursor: pointer;
        }
    </style>

    <section class="section-b-space pt-0">
        <div class="heading-banner">
            <div class="custom-container container">
                <div class="row align-items-center">
                    <div class="col-sm-6">
                        <h4>Check Out</h4>
                    </div>
                    <div class="col-sm-6">
                        <ul class="breadcrumb float-end">
                            <li class="breadcrumb-item">
                                <a class="text-decoration-none text-black" href="/">Home</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a class="text-decoration-none text-black" href="/cart">Cart</a>
                            </li>
                            <li class="breadcrumb-item active">
                                <a class="text-decoration-none text-black" href="#">Check Out</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="checkout-container">
        <div class="custom-container container">
            <div class="row">
                <!-- Left Column: Address and Payment -->
                <div class="col-lg-8">
                    <!-- Address Section -->
                    <div class="checkout-box mb-4">
                        <div class="checkout-title">
                        </div>
                        <div class="address-option">
                            <div class="address-title">
                                <h4>Shipping Address </h4><a class="text-decoration-none" href="#"
                                    data-bs-toggle="modal" data-bs-target="#address-modal" title="add product"
                                    tabindex="0">+ Add New Address</a>
                            </div>
                            <div class="row" id="currentAddresses">

                                <% if (userAddress && userAddress.length> 0) { %>
                                    <% userAddress.forEach((addressGroup)=> { %>
                                        <% addressGroup.address.forEach(( address, index)=> { %>
                                            <div class="col-xxl-4">
                                                <label for="address-billing-0"> <span class="delivery-address-box">
                                                        <span class="form-check">
                                                            <input class="custom-radio" id="address-billing-0"
                                                                type="radio" value="<%= address._id %>"
                                                                checked="checked" name="address"></span><span
                                                            class="address-detail"><span class="address">
                                                                <span
                                                                    class="buttons d-flex justify-content-end align-items-start">
                                                                    <a class="btn btn-outline-danger sm "
                                                                        href="/editAddress?id=<%= address._id %>&loc=%2Fcheckout"
                                                                        title="Edit">Edit</a>
                                                                </span><span class="address-title">
                                                                    <%= address.addressType %>
                                                                </span></span><span class="address"> <span
                                                                    class="address-home"> <span class="address-tag">
                                                                        Address:</span>
                                                                    <%= address.landMark %>,<%= address.city %>
                                                                </span></span><span class="address"> <span
                                                                    class="address-home"> <span class="address-tag">Pin
                                                                        Code:</span>
                                                                    <%= address.pinCode %>
                                                                </span></span><span class="address"> <span
                                                                    class="address-home"> <span
                                                                        class="address-tag">Phone :</span>+91 <%=
                                                                        address.phone %></span></span></span>
                                                    </span>

                                                </label>
                                            </div>
                                            <% }); %>
                                                <% }); %>
                                                    <% } else { %>
                                                        <p>No addresses found.</p>
                                                        <% } %>
                            </div>
                        </div>


                        <div class="payment-options">
                            <h4 class="mb-3">Payment Method</h4>
                            <div class="row gy-3">
                                <div class="col-sm-6">

                                    <div class="payment-box position-relative">
                                        <!-- Radio Button -->
                                        <input
                                            class="form-check-input custom-radio me-2 <% if (finalTotal > 40000 || !COD_enabled) { %> disabled-radio <% } %>"
                                            id="cod" value="COD" type="radio" name="paymentMethod" <%=finalTotal> 40000
                                        || !COD_enabled ? 'disabled' : '' %>
                                        >
                                        <label for="cod" class="form-check-label">COD</label>

                                        <!-- Tooltip Icon -->
                                        <% if (!COD_enabled) { %>
                                            <i class="fas fa-info-circle text-muted ms-2" data-bs-toggle="tooltip"
                                                data-bs-placement="top"
                                                title="COD is not available for orders above ₹40,000"></i>
                                            <% } %>
                                    </div>
                                    <% if (finalTotal> 40000) { %>
                                        <p class="text-danger p-0 m-0">COD is not available for orders above ₹40,000</p>
                                        <% } else if(!COD_enabled){ %>
                                            <p class="text-danger p-0 m-0">COD currently unavailable</p>
                                            <% } %>
                                </div>

                                <script>
                                    // Wait for DOM to be fully loaded
                                    document.addEventListener('DOMContentLoaded', function () {
                                        // Initialize all tooltips on the page
                                        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
                                        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                                            new bootstrap.Tooltip(tooltipTriggerEl);
                                        });
                                    });
                                </script>
                                
                                <div class="col-sm-6">
                                    <div class="payment-box">
                                        <input class="custom-radio me-2" id="razor-pay" value="ONLINE" type="radio"
                                            name="paymentMethod">
                                        <label for="ONLINE">Razor Pay</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Cart Summary -->
                <div class="col-lg-4">
                    <!-- Product Carousel -->
                    <div class="product-carousel mb-4">
                        <div id="productCarousel" class="carousel slide" data-bs-ride="carousel"
                            data-bs-interval="3000">
                            <div class="carousel-indicators">
                                <% cartItems.forEach((item, index)=> { %>
                                    <button type="button" data-bs-target="#productCarousel"
                                        data-bs-slide-to="<%= index %>" class="<%= index === 0 ? 'active' : '' %>"
                                        aria-current="<%= index === 0 ? 'true' : 'false' %>"
                                        aria-label="Slide <%= index + 1 %>">
                                    </button>
                                    <% }); %>
                            </div>
                            <div class="carousel-inner">
                                <% cartItems.forEach((item, index)=> { %>
                                    <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                        <div class="product-slide">
                                            <div class="product-image">
                                                <img src="<%= item.productId.productImage[0] %>"
                                                    alt="<%= item.productId.productName %>">
                                            </div>
                                            <div class="product-info">
                                                <h5>
                                                    <%= item.productId.productName %>
                                                </h5>
                                                <div class="price-info">
                                                    <span class="sale-price">₹<%= item.salePrice.toFixed(2) %></span>
                                                    <% if (item.productId.regularPrice> item.salePrice) { %>
                                                        <span class="regular-price">₹<%= item.productId.regularPrice %>
                                                                </span>
                                                        <span class="discount">
                                                            <%= Math.round((item.productId.regularPrice -
                                                                item.salePrice) / item.productId.regularPrice * 100) %>%
                                                                OFF
                                                        </span>
                                                        <% } %>
                                                </div>
                                                <div class="quantity">Qty: <%= item.quantity %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% }); %>
                            </div>
                            <% if (cartItems.length> 1) { %>
                                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel"
                                    data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon"></span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel"
                                    data-bs-slide="next">
                                    <span class="carousel-control-next-icon"></span>
                                </button>
                                <% } %>
                        </div>
                    </div>

                    <!-- Price Details -->
                    <div class="checkout-box">
                        <div class="checkout-title">
                            <h4>Price Details</h4>
                        </div>
                        <div class="price-details">
                            <div class="cart-listing">

                                <div class="summary-total">
                                    <ul>
                                        <li>
                                            <p>Subtotal</p><span>
                                                ₹ <%= total%>
                                            </span>
                                        </li>
                                        <% if (shippingCost) { %>
                                            <li>
                                                <p>Shipping</p><span>
                                                    <%= shippingCost %>
                                                </span>
                                            </li>
                                            <% } %>
                                                <li>
                                                    <p>Discount</p><span id="discount">
                                                        ₹<%= discount %>
                                                    </span>
                                                </li>

                                                <!-- <li> 
                          <p>Wallet Balance</p><span>$ -84.40</span>
                        </li> -->
                                    </ul>


                                    <div class="total">
                                        <h6>Total : </h6>
                                        <h6>₹<%= finalTotal %>
                                        </h6>
                                    </div>
                                    <button id="placeOrderForm" class="btn btn_black sm w-100 rounded">Place Order
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            /* Header and Breadcrumb styles */
            .heading-banner {
                background: #f8f9fa;
                padding: 15px 0;
                margin-bottom: 30px;
            }

            .heading-banner .custom-container {
                max-width: 1200px !important;
                margin: 0 auto;
                padding: 0 15px;
            }

            /* Main content styles */
            .checkout-container {
                padding: 30px 0;
                width: 100%;
            }

            .checkout-container .custom-container {
                max-width: 1750px !important;
                margin: 0 auto;
                padding: 0 30px;
            }

            .checkout-box {
                background: #fff;
                border-radius: 8px;
                padding: 25px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                margin-bottom: 20px;
                width: 100%;
            }

            .row {
                margin: 0;
                width: 100%;
            }

            .col-lg-8,
            .col-lg-4 {
                padding: 0 15px;
            }

            @media (min-width: 992px) {
                .col-lg-4 {
                    position: sticky;
                    top: 20px;
                    height: fit-content;
                }
            }

            /* Ensure navbar stays at original width */
            header .custom-container {
                max-width: 1200px !important;
                margin: 0 auto;
                padding: 0 15px;
            }

            /* Responsive adjustments */
            @media (max-width: 768px) {

                .heading-banner .custom-container,
                .checkout-container .custom-container,
                header .custom-container {
                    padding: 0 15px;
                }
            }
        </style>

        <!-- Add Address Modal -->
        <div class="modal theme-modal fade address-modal" id="address-modal" tabindex="-1" role="dialog"
            aria-modal="true">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Add Address</h4>
                        <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="addressForm" class="address-form needs-validation" novalidate>
                        <div class="modal-body pt-0">
                            <div class="address-box">
                                <div class="row">
                                    <!-- Address Type Selection -->
                                    <div class="mb-4">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input custom-radio" type="radio" name="addressType"
                                                id="homeAddress" value="home" checked required>
                                            <label class="form-check-label" for="homeAddress">Home</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input custom-radio" type="radio" name="addressType"
                                                id="officeAddress" value="office" required>
                                            <label class="form-check-label" for="officeAddress">Office</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input custom-radio" type="radio" name="addressType"
                                                id="otherAddress" value="others" required>
                                            <label class="form-check-label" for="otherAddress">Others</label>
                                        </div>
                                        <div class="invalid-feedback">Please select an address type.</div>
                                    </div>
                                    <!-- Name -->
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label class="form-label" for="name">Name</label>
                                            <input class="form-control" id="name" name="name" type="text"
                                                placeholder="Enter Name" required minlength="2" maxlength="50"
                                                pattern="^[A-Za-z\s]+$"
                                                oninput="this.value = this.value.replace(/[0-9]/g, '')">
                                            <div class="invalid-feedback">Enter a valid name (letters and spaces only).
                                            </div>
                                        </div>
                                    </div>
                                    <!-- State -->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label" for="state">State</label>
                                            <select class="form-select" id="state" name="state" required>
                                                <option value="">Select State</option>
                                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bihar">Bihar</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Delhi">Delhi</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                            </select>
                                            <div class="invalid-feedback">Please select a state.</div>
                                        </div>
                                    </div>
                                    <!-- City -->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label" for="city">City</label>
                                            <input class="form-control" id="city" name="city" type="text"
                                                placeholder="Enter City" required minlength="2" maxlength="50"
                                                pattern="^[A-Za-z\s]+$"
                                                oninput="this.value = this.value.replace(/[0-9]/g, '')">
                                            <div class="invalid-feedback">Enter a valid city name (letters and spaces
                                                only).</div>
                                        </div>
                                    </div>
                                    <!-- Landmark -->
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label class="form-label" for="landmark">Landmark</label>
                                            <input class="form-control" id="landMark" name="landMark" type="text"
                                                placeholder="Enter Landmark" required minlength="2" maxlength="100"
                                                pattern="^[A-Za-z\s,./-]+$"
                                                oninput="this.value = this.value.replace(/[0-9]/g, '')">
                                            <div class="invalid-feedback">Enter a valid landmark (letters, spaces, and
                                                punctuation only).</div>
                                        </div>
                                    </div>
                                    <!-- Pincode -->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label" for="pincode">Pincode</label>
                                            <input class="form-control" id="pincode" name="pinCode" type="text"
                                                placeholder="Enter Pincode" required pattern="[0-9]{6}" maxlength="6">
                                            <div class="invalid-feedback">Enter a valid 6-digit pincode.</div>
                                        </div>
                                    </div>
                                    <!-- Phone -->
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label class="form-label" for="phone">Phone Number</label>
                                            <input class="form-control" id="phone" name="phone" type="tel"
                                                placeholder="Enter Phone Number" required pattern="[0-9]{10}"
                                                maxlength="10">
                                            <div class="invalid-feedback">Enter a valid 10-digit phone number.</div>
                                        </div>
                                    </div>
                                    <!-- Alternate Phone -->
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label class="form-label" for="altPhone">Alt Phone (optional)</label>
                                            <input class="form-control" id="altPhone" name="altPhone" type="tel"
                                                placeholder="Enter Phone Number" pattern="[0-9]{10}" maxlength="10">
                                            <div class="invalid-feedback">Enter a valid 10-digit phone number.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
                            <button class="btn btn-primary" type="submit">Submit</button>
                        </div>
                    </form>


                </div>
            </div>
        </div>

        <script>

            document.addEventListener('DOMContentLoaded', function () {
                const addressForm = document.getElementById('addressForm');
                if (addressForm) {
                    addressForm.addEventListener('submit', async (event) => {
                        console.log("Form submission intercepted");
                        event.preventDefault();
                        if (!addressForm.checkValidity()) {
                            event.stopPropagation();
                            addressForm.classList.add('was-validated');
                            return;
                        }
                        const formData = new FormData(event.target);
                        const data = Object.fromEntries(formData.entries());

                        try {
                            const response = await fetch('/profile/add-address', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(data),
                            });

                            const result = await response.json();
                            if (response.ok) {

                                if (result.success) {
                                    console.log("Address added successfully");
                                    const modal = bootstrap.Modal.getInstance(document.getElementById('address-modal'));
                                    await Swal.fire({
                                        icon: "success",
                                        title: "Address Added Successfully!",
                                        showConfirmButton: false,
                                        timer: 1500,
                                        width: 500,
                                        heightAuto: true,
                                        borderRadius: '50px',
                                        background: '#f8f9fa',
                                    });
                                    window.location.reload();
                                    if (modal) {
                                        modal.hide();
                                        // Remove the modal backdrop
                                        const backdrop = document.querySelector('.modal-backdrop');
                                        if (backdrop) {
                                            backdrop.remove();
                                        }
                                        document.body.classList.remove('modal-open'); // Ensure no leftover modal styles
                                    }


                                } else {
                                    throw new Error(result.message || "Failed to add address.");
                                    console.log(result.message);
                                }
                            } else {
                                swal.fire({
                                    icon: "error",
                                    title: "Error",
                                    text: result.message || "Server responded with an error.",
                                });
                            }
                        } catch (error) {
                            console.error("Error details:", error);

                            Swal.fire({
                                icon: "error",
                                title: "Error",
                                text: error.message || "Could not add the address. Please try again.",
                            });
                        }
                    });
                } else {
                    console.error("Address form not found");
                }
            });
        </script>


        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const orderForm = document.getElementById('placeOrderForm');
                if (orderForm) {
                    orderForm.addEventListener('click', async (event) => {
                        event.preventDefault();

                        const selectedAddressId = document.querySelector('input[name="address"]:checked')?.value;
                        const selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked')?.value;

                        // Validation: Ensure both address and payment method are selected
                        if (!selectedAddressId) {
                            Toastify({
                                text: "Please select an address.", backgroundColor: "red",
                                style: {
                                    color: "#FFFFFF", // White text color
                                    fontWeight: "bold", // Bold text
                                },
                            }).showToast();
                            return;
                        }
                        if (!selectedPaymentMethod) {
                            Toastify({
                                text: "Please select a payment method.",
                                backgroundColor: "red",
                                style: {
                                    color: "#ffffff", // White text color
                                    fontWeight: "bold", // Bold text
                                    borderRadius: "10px",
                                },
                            }).showToast();
                            return;
                        }

                        // Show confirmation alert
                        const result = await Swal.fire({
                            title: 'Confirm Order',
                            text: 'Are you sure you want to place this order?',
                            icon: 'question',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Yes, place order!',
                            cancelButtonText: 'No, cancel'
                        });

                        if (!result.isConfirmed) {
                            return;
                        }

                        // Get the applied coupon code
                        const appliedCouponElement = document.querySelector('.coupon-input .input-group[data-applied-coupon]');
                        const couponCode = appliedCouponElement ? appliedCouponElement.getAttribute('data-applied-coupon') : '';

                        // Prepare order data
                        const orderData = {
                            addressId: selectedAddressId,
                            paymentMethod: selectedPaymentMethod,
                            totalPrice: '<%= finalTotal %>',
                            Discount: '<%= discount %>',
                            couponCode: couponCode
                        };

                        try {
                            const response = await fetch('/order/place', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(orderData),
                            });

                            const result = await response.json();

                            if (response.ok) {
                                if (selectedPaymentMethod === "ONLINE") {
                                    const razorpayOptions = {
                                        key: result.razorpayKey || '<%= razorpayKey %>',
                                        amount: result.amount,
                                        currency: result.currency,
                                        name: "ShutterCart",
                                        description: "Order Payment",
                                        order_id: result.razorpayOrderId,
                                        handler: async function (response) {
                                            const paymentData = {
                                                razorpayPaymentId: response.razorpay_payment_id,
                                                razorpayOrderId: response.razorpay_order_id,
                                                razorpaySignature: response.razorpay_signature,
                                            };

                                            const verifyResponse = await fetch('/order/verify', {
                                                method: 'POST',
                                                headers: { 'Content-Type': 'application/json' },
                                                body: JSON.stringify(paymentData),
                                            });

                                            const verifyResult = await verifyResponse.json();
                                            if (verifyResponse.ok) {
                                                await Swal.fire({
                                                    icon: 'success',
                                                    title: 'Payment Successful',
                                                    text: 'Your payment has been processed successfully!',
                                                })
                                                window.location.href = `/order/success?Id=${verifyResult.orderId}`;
                                            } else {
                                                await Swal.fire({
                                                    icon: 'error',
                                                    title: 'Payment Failed',
                                                    text: verifyResult.message || 'An error occurred while processing the payment.',
                                                });
                                            }
                                        },
                                        prefill: {
                                            name: "<%= user.name %>",
                                            email: "<%= user.email %>",
                                            contact: "<%= user.phone %>",
                                        },
                                        theme: {
                                            color: "#333",
                                        },
                                    };

                                    const razorpay = new Razorpay(razorpayOptions);
                                    razorpay.open();

                                    razorpay.on('payment.failed', async function (response) {
                                        await Swal.fire({
                                            icon: "error",
                                            title: "Payment Failed",
                                            text: "Payment failed. Please try again.",
                                        });

                                        console.error("Payment failed:", response.error);
                                    });
                                } else {
                                    // COD flow
                                    await Swal.fire({
                                        icon: "success",
                                        title: "Order Placed Successfully",
                                        text: "Your order has been placed successfully.",
                                    });
                                    window.location.href = `/order/success?Id=${result.orderId}`;
                                }
                            } else {
                                swal.fire({
                                    icon: "error",
                                    title: "Error",
                                    text: result.message || "Order placement failed.",
                                });
                            }
                        } catch (error) {
                            console.error("Order Error:", error);
                            swal.fire({
                                icon: "error",
                                title: "Error",
                                text: result.message || "An error occurred while placing the order.",
                            });
                        }
                    });
                }
            });

        </script>

        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

        <!-- ----------------------------------------------- -->


        </script>

        <%- include('../partials/user/footer') %>

            <style>
                .product-carousel {
                    background: #fff;
                    border-radius: 8px;
                    padding: 15px;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                    margin: 0 auto;
                    max-width: 800px;
                    padding-bottom: 35px;
                }

                .product-slide {
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    padding: 5px;
                }

                .product-image {
                    width: 80px;
                    height: 80px;
                    flex-shrink: 0;
                }

                .product-image img {
                    width: 100%;
                    height: 100%;
                    object-fit: contain;
                    border-radius: 4px;
                }

                .product-info {
                    flex-grow: 1;
                }

                .product-info h5 {
                    margin: 0 0 5px;
                    font-size: 0.95em;
                    color: #333;
                }

                .price-info {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    margin-bottom: 4px;
                }

                .sale-price {
                    font-size: 1em;
                    font-weight: 600;
                    color: #333;
                }

                .regular-price {
                    text-decoration: line-through;
                    color: #999;
                    font-size: 0.8em;
                }

                .discount {
                    color: #2ea843;
                    font-size: 0.8em;
                    font-weight: 500;
                }

                .quantity {
                    color: #666;
                    font-size: 0.8em;
                }

                .carousel-indicators {
                    bottom: -30px;
                }

                .carousel-indicators button {
                    width: 6px !important;
                    height: 6px !important;
                    border-radius: 50% !important;
                    background-color: #ccc !important;
                    margin: 0 3px !important;
                    opacity: 0.5;
                }

                .carousel-control-prev,
                .carousel-control-next {
                    width: 25px;
                    height: 25px;
                    background: rgba(0, 0, 0, 0.3);
                    border-radius: 50%;
                    top: 50%;
                    transform: translateY(-50%);
                }

                .carousel-control-prev {
                    left: 5px;
                }

                .carousel-control-next {
                    right: 5px;
                }

                .carousel-control-prev-icon,
                .carousel-control-next-icon {
                    width: 12px;
                    height: 12px;
                }
            </style>

            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    // Initialize the carousel with Bootstrap's carousel method
                    const carousel = new bootstrap.Carousel(document.getElementById('productCarousel'), {
                        interval: 3000,
                        wrap: true,
                        touch: true
                    });

                    // Pause on hover (optional)
                    document.getElementById('productCarousel').addEventListener('mouseenter', function () {
                        carousel.pause();
                    });

                    document.getElementById('productCarousel').addEventListener('mouseleave', function () {
                        carousel.cycle();
                    });
                });
            </script>